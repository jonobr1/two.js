(function(){function q(m,a,b){if(m===a)return 0!==m||1/m==1/a;if(null==m||null==a)return m===a;m._chain&&(m=m._wrapped);a._chain&&(a=a._wrapped);if(m.isEqual&&d.isFunction(m.isEqual))return m.isEqual(a);if(a.isEqual&&d.isFunction(a.isEqual))return a.isEqual(m);var c=u.call(m);if(c!=u.call(a))return!1;switch(c){case "[object String]":return m==String(a);case "[object Number]":return m!=+m?a!=+a:0==m?1/m==1/a:m==+a;case "[object Date]":case "[object Boolean]":return+m==+a;case "[object RegExp]":return m.source==
a.source&&m.global==a.global&&m.multiline==a.multiline&&m.ignoreCase==a.ignoreCase}if("object"!=typeof m||"object"!=typeof a)return!1;for(var e=b.length;e--;)if(b[e]==m)return!0;b.push(m);var e=0,j=!0;if("[object Array]"==c){if(e=m.length,j=e==a.length)for(;e--&&(j=e in m==e in a&&q(m[e],a[e],b)););}else{if("constructor"in m!="constructor"in a||m.constructor!=a.constructor)return!1;for(var n in m)if(d.has(m,n)&&(e++,!(j=d.has(a,n)&&q(m[n],a[n],b))))break;if(j){for(n in a)if(d.has(a,n)&&!e--)break;
j=!e}}b.pop();return j}var f=this,p=f._,l={},k=Array.prototype,c=Object.prototype,b=k.slice,j=k.unshift,u=c.toString,a=c.hasOwnProperty,n=k.forEach,v=k.map,r=k.reduce,e=k.reduceRight,A=k.filter,E=k.every,x=k.some,s=k.indexOf,y=k.lastIndexOf,c=Array.isArray,t=Object.keys,w=Function.prototype.bind,d=function(m){return new I(m)};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=d),exports._=d):f._=d;d.VERSION="1.3.3";var z=d.each=d.forEach=function(m,
a,b){if(null!=m)if(n&&m.forEach===n)m.forEach(a,b);else if(m.length===+m.length)for(var e=0,c=m.length;e<c&&!(e in m&&a.call(b,m[e],e,m)===l);e++);else for(e in m)if(d.has(m,e)&&a.call(b,m[e],e,m)===l)break};d.map=d.collect=function(m,a,d){var b=[];if(null==m)return b;if(v&&m.map===v)return m.map(a,d);z(m,function(m,e,c){b[b.length]=a.call(d,m,e,c)});m.length===+m.length&&(b.length=m.length);return b};d.reduce=d.foldl=d.inject=function(m,a,b,e){var c=2<arguments.length;null==m&&(m=[]);if(r&&m.reduce===
r)return e&&(a=d.bind(a,e)),c?m.reduce(a,b):m.reduce(a);z(m,function(m,d,j){c?b=a.call(e,b,m,d,j):(b=m,c=!0)});if(!c)throw new TypeError("Reduce of empty array with no initial value");return b};d.reduceRight=d.foldr=function(m,a,b,c){var j=2<arguments.length;null==m&&(m=[]);if(e&&m.reduceRight===e)return c&&(a=d.bind(a,c)),j?m.reduceRight(a,b):m.reduceRight(a);var n=d.toArray(m).reverse();c&&!j&&(a=d.bind(a,c));return j?d.reduce(n,a,b,c):d.reduce(n,a)};d.find=d.detect=function(a,d,b){var e;B(a,function(a,
m,c){if(d.call(b,a,m,c))return e=a,!0});return e};d.filter=d.select=function(a,d,b){var e=[];if(null==a)return e;if(A&&a.filter===A)return a.filter(d,b);z(a,function(a,m,c){d.call(b,a,m,c)&&(e[e.length]=a)});return e};d.reject=function(a,d,b){var e=[];if(null==a)return e;z(a,function(a,m,c){d.call(b,a,m,c)||(e[e.length]=a)});return e};d.every=d.all=function(a,d,b){var e=!0;if(null==a)return e;if(E&&a.every===E)return a.every(d,b);z(a,function(a,m,c){if(!(e=e&&d.call(b,a,m,c)))return l});return!!e};
var B=d.some=d.any=function(a,b,e){b||(b=d.identity);var c=!1;if(null==a)return c;if(x&&a.some===x)return a.some(b,e);z(a,function(a,m,d){if(c||(c=b.call(e,a,m,d)))return l});return!!c};d.include=d.contains=function(a,d){var b=!1;return null==a?b:s&&a.indexOf===s?-1!=a.indexOf(d):b=B(a,function(a){return a===d})};d.invoke=function(a,e){var c=b.call(arguments,2);return d.map(a,function(a){return(d.isFunction(e)?e||a:a[e]).apply(a,c)})};d.pluck=function(a,b){return d.map(a,function(a){return a[b]})};
d.max=function(a,b,e){if(!b&&d.isArray(a)&&a[0]===+a[0])return Math.max.apply(Math,a);if(!b&&d.isEmpty(a))return-Infinity;var c={computed:-Infinity};z(a,function(a,d,m){d=b?b.call(e,a,d,m):a;d>=c.computed&&(c={value:a,computed:d})});return c.value};d.min=function(a,b,e){if(!b&&d.isArray(a)&&a[0]===+a[0])return Math.min.apply(Math,a);if(!b&&d.isEmpty(a))return Infinity;var c={computed:Infinity};z(a,function(a,d,m){d=b?b.call(e,a,d,m):a;d<c.computed&&(c={value:a,computed:d})});return c.value};d.shuffle=
function(a){var d=[],b;z(a,function(a,m){b=Math.floor(Math.random()*(m+1));d[m]=d[b];d[b]=a});return d};d.sortBy=function(a,b,e){var c=d.isFunction(b)?b:function(a){return a[b]};return d.pluck(d.map(a,function(a,d,m){return{value:a,criteria:c.call(e,a,d,m)}}).sort(function(a,d){var m=a.criteria,b=d.criteria;return void 0===m?1:void 0===b?-1:m<b?-1:m>b?1:0}),"value")};d.groupBy=function(a,b){var e={},c=d.isFunction(b)?b:function(a){return a[b]};z(a,function(a,d){var m=c(a,d);(e[m]||(e[m]=[])).push(a)});
return e};d.sortedIndex=function(a,b,e){e||(e=d.identity);for(var c=0,j=a.length;c<j;){var n=c+j>>1;e(a[n])<e(b)?c=n+1:j=n}return c};d.toArray=function(a){return!a?[]:d.isArray(a)||d.isArguments(a)?b.call(a):a.toArray&&d.isFunction(a.toArray)?a.toArray():d.values(a)};d.size=function(a){return d.isArray(a)?a.length:d.keys(a).length};d.first=d.head=d.take=function(a,d,e){return null!=d&&!e?b.call(a,0,d):a[0]};d.initial=function(a,d,e){return b.call(a,0,a.length-(null==d||e?1:d))};d.last=function(a,
d,e){return null!=d&&!e?b.call(a,Math.max(a.length-d,0)):a[a.length-1]};d.rest=d.tail=function(a,d,e){return b.call(a,null==d||e?1:d)};d.compact=function(a){return d.filter(a,function(a){return!!a})};d.flatten=function(a,b){return d.reduce(a,function(a,m){if(d.isArray(m))return a.concat(b?m:d.flatten(m));a[a.length]=m;return a},[])};d.without=function(a){return d.difference(a,b.call(arguments,1))};d.uniq=d.unique=function(a,b,e){e=e?d.map(a,e):a;var c=[];3>a.length&&(b=!0);d.reduce(e,function(e,j,
n){if(b?d.last(e)!==j||!e.length:!d.include(e,j))e.push(j),c.push(a[n]);return e},[]);return c};d.union=function(){return d.uniq(d.flatten(arguments,!0))};d.intersection=d.intersect=function(a){var e=b.call(arguments,1);return d.filter(d.uniq(a),function(a){return d.every(e,function(m){return 0<=d.indexOf(m,a)})})};d.difference=function(a){var e=d.flatten(b.call(arguments,1),!0);return d.filter(a,function(a){return!d.include(e,a)})};d.zip=function(){for(var a=b.call(arguments),e=d.max(d.pluck(a,"length")),
c=Array(e),j=0;j<e;j++)c[j]=d.pluck(a,""+j);return c};d.indexOf=function(a,b,e){if(null==a)return-1;var c;if(e)return e=d.sortedIndex(a,b),a[e]===b?e:-1;if(s&&a.indexOf===s)return a.indexOf(b);e=0;for(c=a.length;e<c;e++)if(e in a&&a[e]===b)return e;return-1};d.lastIndexOf=function(a,d){if(null==a)return-1;if(y&&a.lastIndexOf===y)return a.lastIndexOf(d);for(var e=a.length;e--;)if(e in a&&a[e]===d)return e;return-1};d.range=function(a,d,e){1>=arguments.length&&(d=a||0,a=0);e=arguments[2]||1;for(var b=
Math.max(Math.ceil((d-a)/e),0),c=0,j=Array(b);c<b;)j[c++]=a,a+=e;return j};var M=function(){};d.bind=function(a,e){var c,j;if(a.bind===w&&w)return w.apply(a,b.call(arguments,1));if(!d.isFunction(a))throw new TypeError;j=b.call(arguments,2);return c=function(){if(!(this instanceof c))return a.apply(e,j.concat(b.call(arguments)));M.prototype=a.prototype;var d=new M,n=a.apply(d,j.concat(b.call(arguments)));return Object(n)===n?n:d}};d.bindAll=function(a){var e=b.call(arguments,1);0==e.length&&(e=d.functions(a));
z(e,function(e){a[e]=d.bind(a[e],a)});return a};d.memoize=function(a,e){var b={};e||(e=d.identity);return function(){var c=e.apply(this,arguments);return d.has(b,c)?b[c]:b[c]=a.apply(this,arguments)}};d.delay=function(a,d){var e=b.call(arguments,2);return setTimeout(function(){return a.apply(null,e)},d)};d.defer=function(a){return d.delay.apply(d,[a,1].concat(b.call(arguments,1)))};d.throttle=function(a,e){var b,c,j,n,t,w,k=d.debounce(function(){t=n=!1},e);return function(){b=this;c=arguments;j||
(j=setTimeout(function(){j=null;t&&a.apply(b,c);k()},e));n?t=!0:w=a.apply(b,c);k();n=!0;return w}};d.debounce=function(a,d,e){var b;return function(){var c=this,j=arguments;e&&!b&&a.apply(c,j);clearTimeout(b);b=setTimeout(function(){b=null;e||a.apply(c,j)},d)}};d.once=function(a){var d=!1,e;return function(){if(d)return e;d=!0;return e=a.apply(this,arguments)}};d.wrap=function(a,d){return function(){var e=[a].concat(b.call(arguments,0));return d.apply(this,e)}};d.compose=function(){var a=arguments;
return function(){for(var d=arguments,e=a.length-1;0<=e;e--)d=[a[e].apply(this,d)];return d[0]}};d.after=function(a,d){return 0>=a?d():function(){if(1>--a)return d.apply(this,arguments)}};d.keys=t||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var e=[],b;for(b in a)d.has(a,b)&&(e[e.length]=b);return e};d.values=function(a){return d.map(a,d.identity)};d.functions=d.methods=function(a){var e=[],b;for(b in a)d.isFunction(a[b])&&e.push(b);return e.sort()};d.extend=function(a){z(b.call(arguments,
1),function(d){for(var e in d)a[e]=d[e]});return a};d.pick=function(a){var e={};z(d.flatten(b.call(arguments,1)),function(d){d in a&&(e[d]=a[d])});return e};d.defaults=function(a){z(b.call(arguments,1),function(d){for(var e in d)null==a[e]&&(a[e]=d[e])});return a};d.clone=function(a){return!d.isObject(a)?a:d.isArray(a)?a.slice():d.extend({},a)};d.tap=function(a,d){d(a);return a};d.isEqual=function(a,d){return q(a,d,[])};d.isEmpty=function(a){if(null==a)return!0;if(d.isArray(a)||d.isString(a))return 0===
a.length;for(var e in a)if(d.has(a,e))return!1;return!0};d.isElement=function(a){return!!(a&&1==a.nodeType)};d.isArray=c||function(a){return"[object Array]"==u.call(a)};d.isObject=function(a){return a===Object(a)};d.isArguments=function(a){return"[object Arguments]"==u.call(a)};d.isArguments(arguments)||(d.isArguments=function(a){return!(!a||!d.has(a,"callee"))});d.isFunction=function(a){return"[object Function]"==u.call(a)};d.isString=function(a){return"[object String]"==u.call(a)};d.isNumber=function(a){return"[object Number]"==
u.call(a)};d.isFinite=function(a){return d.isNumber(a)&&isFinite(a)};d.isNaN=function(a){return a!==a};d.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==u.call(a)};d.isDate=function(a){return"[object Date]"==u.call(a)};d.isRegExp=function(a){return"[object RegExp]"==u.call(a)};d.isNull=function(a){return null===a};d.isUndefined=function(a){return void 0===a};d.has=function(d,e){return a.call(d,e)};d.noConflict=function(){f._=p;return this};d.identity=function(a){return a};d.times=
function(a,d,e){for(var b=0;b<a;b++)d.call(e,b)};d.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};d.result=function(a,e){if(null==a)return null;var b=a[e];return d.isFunction(b)?b.call(a):b};d.mixin=function(a){z(d.functions(a),function(e){var c=d[e]=a[e];I.prototype[e]=function(){var a=b.call(arguments);j.call(a,this._wrapped);return O(c.apply(d,a),this._chain)}})};var H=0;d.uniqueId=
function(a){var d=H++;return a?a+d:d};d.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var D=/.^/,N={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"},P;for(P in N)N[N[P]]=P;var V=/\\|'|\r|\n|\t|\u2028|\u2029/g,W=/\\(\\|'|r|n|t|u2028|u2029)/g,Q=function(a){return a.replace(W,function(a,d){return N[d]})};d.template=function(a,e,b){b=d.defaults(b||{},d.templateSettings);a="__p+='"+a.replace(V,function(a){return"\\"+N[a]}).replace(b.escape||
D,function(a,d){return"'+\n_.escape("+Q(d)+")+\n'"}).replace(b.interpolate||D,function(a,d){return"'+\n("+Q(d)+")+\n'"}).replace(b.evaluate||D,function(a,d){return"';\n"+Q(d)+"\n;__p+='"})+"';\n";b.variable||(a="with(obj||{}){\n"+a+"}\n");a="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+a+"return __p;\n";var c=new Function(b.variable||"obj","_",a);if(e)return c(e,d);e=function(a){return c.call(this,a,d)};e.source="function("+(b.variable||"obj")+"){\n"+a+"}";return e};
d.chain=function(a){return d(a).chain()};var I=function(a){this._wrapped=a};d.prototype=I.prototype;var O=function(a,e){return e?d(a).chain():a};d.mixin(d);z("pop push reverse shift sort splice unshift".split(" "),function(a){var d=k[a];I.prototype[a]=function(){var e=this._wrapped;d.apply(e,arguments);var b=e.length;("shift"==a||"splice"==a)&&0===b&&delete e[0];return O(e,this._chain)}});z(["concat","join","slice"],function(a){var d=k[a];I.prototype[a]=function(){return O(d.apply(this._wrapped,arguments),
this._chain)}});I.prototype.chain=function(){this._chain=!0;return this};I.prototype.value=function(){return this._wrapped}}).call(this);var Backbone=Backbone||{};
(function(){var q=[].slice,f=/\s+/,p=function(c,b,j,k){if(!j)return!0;if("object"===typeof j)for(var a in j)c[b].apply(c,[a,j[a]].concat(k));else if(f.test(j)){j=j.split(f);a=0;for(var n=j.length;a<n;a++)c[b].apply(c,[j[a]].concat(k))}else return!0},l=function(c,b,j){var k;c=-1;var a=b.length;switch(j.length){case 0:for(;++c<a;)(k=b[c]).callback.call(k.ctx);break;case 1:for(;++c<a;)(k=b[c]).callback.call(k.ctx,j[0]);break;case 2:for(;++c<a;)(k=b[c]).callback.call(k.ctx,j[0],j[1]);break;case 3:for(;++c<
a;)(k=b[c]).callback.call(k.ctx,j[0],j[1],j[2]);break;default:for(;++c<a;)(k=b[c]).callback.apply(k.ctx,j)}},k=Backbone.Events={on:function(c,b,j){if(!p(this,"on",c,[b,j])||!b)return this;this._events||(this._events={});(this._events[c]||(this._events[c]=[])).push({callback:b,context:j,ctx:j||this});return this},once:function(c,b,j){if(!p(this,"once",c,[b,j])||!b)return this;var k=this,a=_.once(function(){k.off(c,a);b.apply(this,arguments)});a._callback=b;this.on(c,a,j);return this},off:function(c,
b,j){var k,a,n,f,r,e,A,l;if(!this._events||!p(this,"off",c,[b,j]))return this;if(!c&&!b&&!j)return this._events={},this;f=c?[c]:_.keys(this._events);r=0;for(e=f.length;r<e;r++)if(c=f[r],k=this._events[c]){n=[];if(b||j){A=0;for(l=k.length;A<l;A++)a=k[A],(b&&b!==(a.callback._callback||a.callback)||j&&j!==a.context)&&n.push(a)}this._events[c]=n}return this},trigger:function(c){if(!this._events)return this;var b=q.call(arguments,1);if(!p(this,"trigger",c,b))return this;var j=this._events[c],k=this._events.all;
j&&l(this,j,b);k&&l(this,k,arguments);return this},listenTo:function(c,b,j){var k=this._listeners||(this._listeners={}),a=c._listenerId||(c._listenerId=_.uniqueId("l"));k[a]=c;c.on(b,j||this,this);return this},stopListening:function(c,b,j){var k=this._listeners;if(k){if(c)c.off(b,j,this),!b&&!j&&delete k[c._listenerId];else{for(var a in k)k[a].off(null,null,this);this._listeners={}}return this}}};k.bind=k.on;k.unbind=k.off})();(function(){for(var q=0,f=["ms","moz","webkit","o"],p=0;p<f.length&&!window.requestAnimationFrame;++p)window.requestAnimationFrame=window[f[p]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[f[p]+"CancelAnimationFrame"]||window[f[p]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(f){var k=(new Date).getTime(),c=Math.max(0,16-(k-q)),b=window.setTimeout(function(){f(k+c)},c);q=k+c;return b});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(f){clearTimeout(f)})})();(function(){function q(){var a=document.body.getBoundingClientRect(),b=this.width=a.width,a=this.height=a.height;this.renderer.setSize(b,a);this.trigger(e.Events.resize,b,a)}var f=this,p=f.Two||{},l=Math.sin,k=Math.cos,c=Math.atan2,b=Math.sqrt,j=Math.abs,u=Math.PI,a=2*u,n=u/2,v=Math.pow,r={hasEventListeners:_.isFunction(f.addEventListener),bind:function(a,e,d,b){this.hasEventListeners?a.addEventListener(e,d,!!b):a.attachEvent("on"+e,d);return this},unbind:function(a,e,d,b){this.hasEventListeners?
a.removeEventListeners(e,d,!!b):a.detachEvent("on"+e,d);return this}},e=f.Two=function(a){a=_.defaults(a||{},{fullscreen:!1,width:640,height:480,type:e.Types.svg,autostart:!1});this.type=a.type;this.renderer=new e[this.type](this);e.Utils.setPlaying.call(this,a.autostart);this.frameCount=0;a.fullscreen?(a=_.bind(q,this),_.extend(document.body.style,{overflow:"hidden",margin:0,padding:0,top:0,left:0,right:0,bottom:0,position:"fixed"}),_.extend(this.renderer.domElement.style,{display:"block",top:0,
left:0,right:0,bottom:0,position:"fixed"}),r.bind(window,"resize",a),a()):(this.renderer.setSize(a.width,a.height),this.width=a.width,this.height=a.height);this.scene=new e.Group;this.renderer.add(this.scene);e.Instances.push(this)};_.extend(e,{Array:f.Float32Array||Array,Types:{webgl:"WebGLRenderer",svg:"SVGRenderer",canvas:"CanvasRenderer"},Properties:{hierarchy:"hierarchy",demotion:"demotion"},Events:{play:"play",pause:"pause",update:"update",render:"render",resize:"resize",change:"change"},Resolution:8,
Instances:[],noConflict:function(){f.Two=p;return this},Utils:{Curve:{CollinearityEpsilon:v(10,-30),RecursionLimit:16,CuspLimit:0,Tolerance:{distance:0.25,angle:0,epsilon:0.01}},setPlaying:function(a){_.defer(_.bind(function(){this.playing=!!a},this))},applySvgAttributes:function(a,e){e.cap="butt";e.join="bevel";_.each(a.attributes,function(a){switch(a.nodeName){case "visibility":e.visible=!!a.nodeValue;break;case "stroke-linecap":e.cap=a.nodeValue;break;case "stroke-linejoin":e.join=a.nodeValue;
break;case "stroke-miterlimit":e.miter=a.nodeValue;break;case "stroke-width":e.linewidth=parseFloat(a.nodeValue);break;case "stroke-opacity":case "fill-opacity":e.opacity=a.nodeValue;break;case "fill":e.fill=a.nodeValue;break;case "stroke":e.stroke=a.nodeValue}});return e},read:{svg:function(){return e.Utils.read.g.apply(this,arguments)},g:function(a){var b=new e.Group;this.add(b);_.each(a.childNodes,function(a){if(a.localName){var c=a.localName.toLowerCase();c in e.Utils.read&&(a=e.Utils.read[c].call(this,
a),b.add(a))}},this);return e.Utils.applySvgAttributes(a,b)},polygon:function(a,b){var d=a.points,c=_.map(_.range(d.numberOfItems),function(a){a=d.getItem(a);return new e.Vector(a.x,a.y)}),c=(new e.Polygon(c,!b)).noStroke();return e.Utils.applySvgAttributes(a,c)},polyline:function(a){return e.Utils.read.polygon(a,!0)},path:function(a){var b=a.getAttribute("d"),b=_.flatten(_.map(_.compact(b.split(/M/g)),function(a){a=_.map(_.compact(a.split(/m/g)),function(a,d){return 0>=d?a:"m"+a});a[0]="M"+a[0];
return a})),d=new e.Vector,c=new e.Vector;return _.map(b,function(b){var j,n=!1,k=!1;b=_.flatten(_.map(b.match(/[a-z][^a-z]*/ig),function(a){var b,t,f=a[0],r=f.toLowerCase();j=a.slice(1).trim().split(/[\s,]+|(?=[+\-])/);n=f===r;var w,u,m;switch(r){case "z":k=!0;break;case "m":case "l":t=parseFloat(j[0]);b=parseFloat(j[1]);b=new e.Vector(t,b);n&&b.addSelf(d);d.copy(b);break;case "h":case "v":t="h"===r?"x":"y";a="x"===t?"y":"x";b=new e.Vector;b[t]=parseFloat(j[0]);b[a]=d[a];n&&(b[t]+=d[t]);d.copy(b);
break;case "s":case "c":b=d.x;a=d.y;"c"===r?(f=parseFloat(j[0]),t=parseFloat(j[1]),r=parseFloat(j[2]),w=parseFloat(j[3]),u=parseFloat(j[4]),m=parseFloat(j[5])):(w=(new e.Vector).copy(d).subSelf(c),f=parseFloat(w.x),t=parseFloat(w.y),r=parseFloat(j[0]),w=parseFloat(j[1]),u=parseFloat(j[2]),m=parseFloat(j[3]));n&&(f+=b,t+=a,r+=b,w+=a,u+=b,m+=a);b=e.Utils.subdivide(b,a,f,t,r,w,u,m);d.set(u,m);c.set(r,w);break;case "t":case "q":b=d.x;a=d.y;c.isZero()?(f=b,t=a):(f=c.x,a=c.y);"q"===r?(r=parseFloat(j[0]),
w=parseFloat(j[1]),u=parseFloat(j[1]),m=parseFloat(j[2])):(w=(new e.Vector).copy(d).subSelf(c),r=parseFloat(w.x),w=parseFloat(w.y),u=parseFloat(j[0]),m=parseFloat(j[1]));n&&(f+=b,t+=a,r+=b,w+=a,u+=b,m+=a);b=e.Utils.subdivide(b,a,f,t,r,w,u,m);d.set(u,m);c.set(r,w);break;case "a":throw new e.Utils.Error("not yet able to interpret Elliptical Arcs.");}return b}));_.isUndefined(b[b.length-1])&&b.pop();b=(new e.Polygon(b,k)).noStroke();return e.Utils.applySvgAttributes(a,b)})},circle:function(b){var c=
parseFloat(b.getAttribute("cx")),d=parseFloat(b.getAttribute("cy")),j=parseFloat(b.getAttribute("r")),n=e.Resolution,f=_.map(_.range(n),function(d){var b=d/n*a;d=j*k(b);b=j*l(b);return new e.Vector(d,b)},this),f=(new e.Polygon(f,!0,!0)).noStroke();f.translation.set(c,d);return e.Utils.applySvgAttributes(b,f)},ellipse:function(b){var c=parseFloat(b.getAttribute("cx")),d=parseFloat(b.getAttribute("cy")),j=parseFloat(b.getAttribute("rx")),n=parseFloat(b.getAttribute("ry")),f=e.Resolution,r=_.map(_.range(f),
function(d){var b=d/f*a;d=j*k(b);b=n*l(b);return new e.Vector(d,b)},this),r=(new e.Polygon(r,!0,!0)).noStroke();r.translation.set(c,d);return e.Utils.applySvgAttributes(b,r)},rect:function(a){var b=parseFloat(a.getAttribute("x")),d=parseFloat(a.getAttribute("y")),c=parseFloat(a.getAttribute("width")),j=parseFloat(a.getAttribute("height")),c=c/2,j=j/2,n=[new e.Vector(c,j),new e.Vector(-c,j),new e.Vector(-c,-j),new e.Vector(c,-j)],n=(new e.Polygon(n,!0)).noStroke();n.translation.set(b+c,d+j);return e.Utils.applySvgAttributes(a,
n)},line:function(a){var b=parseFloat(a.getAttribute("x1")),d=parseFloat(a.getAttribute("y1")),c=parseFloat(a.getAttribute("x2")),j=parseFloat(a.getAttribute("y2")),c=(c-b)/2,j=(j-d)/2,n=[new e.Vector(-c,-j),new e.Vector(c,j)],n=(new e.Polygon(n)).noFill();n.translation.set(b+c,d+j);return e.Utils.applySvgAttributes(a,n)}},subdivide:function(b,n,d,k,f,r,v,p,A){var l=e.Utils.Curve.CollinearityEpsilon,E=e.Utils.Curve.RecursionLimit,s=e.Utils.Curve.CuspLimit,x=e.Utils.Curve.Tolerance,q;A=A||0;if(A>E)return[];
var E=(b+d)/2,y=(n+k)/2,m=(d+f)/2,L=(k+r)/2,R=(f+v)/2,S=(r+p)/2,T=(E+m)/2,U=(y+L)/2,m=(m+R)/2,L=(L+S)/2,F=(T+m)/2,G=(U+L)/2;q=v-b;var C=p-n,J=j((d-v)*C-(k-p)*q),K=j((f-v)*C-(r-p)*q);if(0<A){if(J>l&&K>l&&(J+K)*(J+K)<=x.distance*(q*q+C*C)){if(x.angle<x.epsilon)return[new e.Vector(F,G)];q=c(r-k,f-d);l=j(q-c(k-n,d-b));q=j(c(p-r,v-f)-q);l>=u&&(l=a-l);q>=u&&(q=a-q);if(l+q<x.angle)return[new e.Vector(F,G)];if(0!==s){if(l>s)return[new e.Vector(d,k)];if(q>s)return[new e.Vector(f,r)]}}}else if(J>l)if(J*J<=
x.distance*(q*q+C*C)){if(x.angle<x.epsilon)return[new e.Vector(F,G)];l=j(c(r-k,f-d)-c(k-n,d-b));l>=u&&(l=a-l);if(l<x.angle)return[new e.Vector(d,k),new e.Vector(f,r)];if(0!==s&&l>s)return[new e.Vector(d,k)]}else if(K>l){if(K*K<=x.distance*(q*q+C*C)){if(x.angle<x.epsilon)return[new e.Vector(F,G)];l=j(c(p-r,v-f)-c(r-k,f-d));l>=u&&(l=a-l);if(l<x.angle)return[new e.Vector(d,k),new e.Vector(f,r)];if(0!==s&&l>s)return[new e.Vector2(f,r)]}}else if(q=F-(b+v)/2,C=G-(n+p)/2,q*q+C*C<=x.distance)return[new e.Vector(F,
G)];return e.Utils.subdivide(b,n,E,y,T,U,F,G,A+1).concat(e.Utils.subdivide(F,G,m,L,R,S,v,p,A+1))},getCurveFromPoints:function(a,b){for(var d=[],e=a.length,c=e-1,j=0;j<e;j++){var n=a[j],k={x:n.x,y:n.y};d.push(k);var n=b?y(j-1,e):Math.max(j-1,0),f=b?y(j+1,e):Math.min(j+1,c);s(a[n],k,a[f]);!k.u.x&&!k.u.y&&(k.u.x=k.x,k.u.y=k.y);!k.v.x&&!k.v.y&&(k.v.x=k.x,k.v.y=k.y)}return d},getControlPoints:function(a,b,d){var e=x(a,b),c=x(d,b);a=A(a,b);d=A(d,b);var j=(e+c)/2;if(1E-4>a||1E-4>d)return b.u={x:b.x,y:b.y},
b.v={x:b.x,y:b.y},b;a*=0.33;d*=0.33;j=c<e?j+n:j-n;e={x:b.x+k(j)*a,y:b.y+l(j)*a};j-=u;c={x:b.x+k(j)*d,y:b.y+l(j)*d};b.u=e;b.v=c;return b},angleBetween:function(a,b){return c(a.y-b.y,a.x-b.x)},distanceBetweenSquared:function(a,b){var d=a.x-b.x,e=a.y-b.y;return d*d+e*e},distanceBetween:function(a,e){return b(E(a,e))},mod:function(a,b){for(;0>a;)a+=b;return a%b},Error:function(a){this.name="two.js";this.message=a}}});e.Utils.Error.prototype=Error();e.Utils.Error.prototype.constructor=e.Utils.Error;var A=
e.Utils.distanceBetween,E=e.Utils.distanceBetweenSquared,x=e.Utils.angleBetween,s=e.Utils.getControlPoints,y=e.Utils.mod;_.extend(e.prototype,Backbone.Events,{appendTo:function(a){a.appendChild(this.renderer.domElement);return this},play:function(){e.Utils.setPlaying.call(this,!0);return this.trigger(e.Events.play)},pause:function(){this.playing=!1;return this.trigger(e.Events.pause)},update:function(){_.defer(_.bind(function(){var a=!!this._lastFrame,b=(window.performance&&window.performance.now?
window.performance:Date).now();this.frameCount++;a&&(this.timeDelta=parseFloat((b-this._lastFrame).toFixed(3)));this._lastFrame=b;var a=this.width,b=this.height,d=this.renderer;(a!==d.width||b!==d.height)&&d.setSize(a,b);this.trigger(e.Events.update,this.frameCount,this.timeDelta);this.render()},this));return this},render:function(){this.renderer.render();return this.trigger(e.Events.render,this.frameCount)},add:function(a){var b=a;_.isArray(a)||(b=_.toArray(arguments));this.scene.add(b);return this},
remove:function(a){var b=a;_.isArray(a)||(b=_.toArray(arguments));this.scene.remove(b);return this},clear:function(){_.each(this.scene.children,function(a){a.remove()});return this},makeLine:function(a,b,d,c){d=(d-a)/2;c=(c-b)/2;var j=[new e.Vector(-d,-c),new e.Vector(d,c)],j=(new e.Polygon(j)).noFill();j.translation.set(a+d,b+c);this.scene.add(j);return j},makeRectangle:function(a,b,d,c){d/=2;c/=2;c=[new e.Vector(d,c),new e.Vector(-d,c),new e.Vector(-d,-c),new e.Vector(d,-c)];c=new e.Polygon(c,!0);
c.translation.set(a,b);this.scene.add(c);return c},makeCircle:function(a,b,d){return this.makeEllipse(a,b,d,d)},makeEllipse:function(b,c,d,j){var n=e.Resolution,f=_.map(_.range(n),function(b){var c=b/n*a;b=d*k(c);c=j*l(c);return new e.Vector(b,c)},this),f=new e.Polygon(f,!0,!0);f.translation.set(b,c);this.scene.add(f);return f},makeCurve:function(a){var b=arguments.length,d=a;if(!_.isArray(a))for(var d=[],c=0;c<b;c+=2){var j=arguments[c];if(!_.isNumber(j))break;d.push(new e.Vector(j,arguments[c+1]))}var b=
arguments[b-1],d=new e.Polygon(d,!(_.isBoolean(b)&&b),!0),b=d.getBoundingClientRect(),n=b.left+b.width/2,k=b.top+b.height/2;_.each(d.vertices,function(a){a.x-=n;a.y-=k});d.translation.set(n,k);this.scene.add(d);return d},makePolygon:function(a){var b=arguments.length,d=a;if(!_.isArray(a))for(var d=[],c=0;c<b;c+=2){var j=arguments[c];if(!_.isNumber(j))break;d.push(new e.Vector(j,arguments[c+1]))}b=arguments[b-1];d=new e.Polygon(d,!(_.isBoolean(b)&&b));d.center();this.scene.add(d);return d},makeGroup:function(a){var b=
a;_.isArray(a)||(b=_.toArray(arguments));var d=new e.Group;this.scene.add(d);d.add(b);return d},interpret:function(a){var b=a.tagName.toLowerCase();if(!(b in e.Utils.read))return null;a=e.Utils.read[b].call(this,a);this.add(a);return a}});(function(){_.each(e.Instances,function(a){a.playing&&a.update()});requestAnimationFrame(arguments.callee)})();"function"===typeof define&&define.amd?define(function(){return e}):"undefined"!=typeof module&&module.exports&&(module.exports=e)})();(function(){var q=Two.Vector=function(f,p){f=f||0;p=p||0;Object.defineProperty(this,"x",{get:function(){return f},set:function(l){f=l;this.trigger(Two.Events.change,"x")}});Object.defineProperty(this,"y",{get:function(){return p},set:function(f){p=f;this.trigger(Two.Events.change,"y")}})};_.extend(q,{});_.extend(q.prototype,Backbone.Events,{set:function(f,p){this.x=f;this.y=p;return this},copy:function(f){this.x=f.x;this.y=f.y;return this},clear:function(){this.y=this.x=0;return this},clone:function(){return new q(this.x,
this.y)},add:function(f,p){this.x=f.x+p.x;this.y=f.y+p.y;return this},addSelf:function(f){this.x+=f.x;this.y+=f.y;return this},sub:function(f,p){this.x=f.x-p.x;this.y=f.y-p.y;return this},subSelf:function(f){this.x-=f.x;this.y-=f.y;return this},multiplySelf:function(f){this.x*=f.x;this.y*=f.y;return this},multiplyScalar:function(f){this.x*=f;this.y*=f;return this},divideScalar:function(f){f?(this.x/=f,this.y/=f):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(f){return this.x*
f.x+this.y*f.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(f){return Math.sqrt(this.distanceToSquared(f))},distanceToSquared:function(f){var p=this.x-f.x;f=this.y-f.y;return p*p+f*f},setLength:function(f){return this.normalize().multiplyScalar(f)},equals:function(f){return 1E-4>this.distanceTo(f)},lerp:function(f,p){return this.set((f.x-this.x)*
p+this.x,(f.y-this.y)*p+this.y)},isZero:function(){return 1E-4>this.length()}})})();(function(){_.range(6);var q=Math.cos,f=Math.sin,p=Math.tan,l=Two.Matrix=function(k,c,b,j,f,a){this.elements=new Two.Array(9);var n=k;_.isArray(n)||(n=_.toArray(arguments));this.identity().set(n)};_.extend(l,{Identity:[1,0,0,0,1,0,0,0,1],Multiply:function(k,c){if(3>=c.length){var b=c[0]||0,j=c[1]||0,f=c[2]||0;return{x:k[0]*b+k[1]*j+k[2]*f,y:k[3]*b+k[4]*j+k[5]*f,z:k[6]*b+k[7]*j+k[8]*f}}var b=k[0],j=k[1],f=k[2],a=k[3],n=k[4],v=k[5],r=k[6],e=k[7],l=k[8],p=c[0],q=c[1],s=c[2],y=c[3],t=c[4],w=c[5],d=c[6],
z=c[7],B=c[8];return[b*p+j*y+f*d,b*q+j*t+f*z,b*s+j*w+f*B,a*p+n*y+v*d,a*q+n*t+v*z,a*s+n*w+v*B,r*p+e*y+l*d,r*q+e*t+l*z,r*s+e*w+l*B]}});_.extend(l.prototype,Backbone.Events,{set:function(k,c,b,j,f,a){var n=k;_.isArray(n)||(n=_.toArray(arguments));_.each(n,function(a,b){_.isNumber(a)&&(this.elements[b]=a)},this);return this.trigger(Two.Events.change)},identity:function(){this.set(l.Identity);return this},multiply:function(k,c,b,j,f,a,n,v,r){var e=arguments,l=e.length;if(1>=l)return _.each(this.elements,
function(a,b){this.elements[b]=a*k},this),this.trigger(Two.Events.change);if(3>=l)return k=k||0,c=c||0,b=b||0,f=this.elements,{x:f[0]*k+f[1]*c+f[2]*b,y:f[3]*k+f[4]*c+f[5]*b,z:f[6]*k+f[7]*c+f[8]*b};l=this.elements;A0=l[0];A1=l[1];A2=l[2];A3=l[3];A4=l[4];A5=l[5];A6=l[6];A7=l[7];A8=l[8];B0=e[0];B1=e[1];B2=e[2];B3=e[3];B4=e[4];B5=e[5];B6=e[6];B7=e[7];B8=e[8];this.elements[0]=A0*B0+A1*B3+A2*B6;this.elements[1]=A0*B1+A1*B4+A2*B7;this.elements[2]=A0*B2+A1*B5+A2*B8;this.elements[3]=A3*B0+A4*B3+A5*B6;this.elements[4]=
A3*B1+A4*B4+A5*B7;this.elements[5]=A3*B2+A4*B5+A5*B8;this.elements[6]=A6*B0+A7*B3+A8*B6;this.elements[7]=A6*B1+A7*B4+A8*B7;this.elements[8]=A6*B2+A7*B5+A8*B8;return this.trigger(Two.Events.change)},inverse:function(k){var c=this.elements;k=k||new Two.Matrix;var b=c[0],j=c[1],f=c[2],a=c[3],n=c[4],v=c[5],r=c[6],e=c[7],c=c[8],l=c*n-v*e,p=-c*a+v*r,q=e*a-n*r,s=b*l+j*p+f*q;if(!s)return null;s=1/s;k.elements[0]=l*s;k.elements[1]=(-c*j+f*e)*s;k.elements[2]=(v*j-f*n)*s;k.elements[3]=p*s;k.elements[4]=(c*b-
f*r)*s;k.elements[5]=(-v*b+f*a)*s;k.elements[6]=q*s;k.elements[7]=(-e*b+j*r)*s;k.elements[8]=(n*b-j*a)*s;return k},scale:function(k,c){1>=arguments.length&&(c=k);return this.multiply(k,0,0,0,c,0,0,0,1)},rotate:function(k){var c=q(k);k=f(k);return this.multiply(c,-k,0,k,c,0,0,0,1)},translate:function(k,c){return this.multiply(1,0,k,0,1,c,0,0,1)},skewX:function(k){k=p(k);return this.multiply(1,k,0,0,1,0,0,0,1)},skewY:function(k){k=p(k);return this.multiply(1,0,0,k,1,0,0,0,1)},toString:function(){return this.toArray().join(" ")},
toArray:function(k){var c=this.elements,b=parseFloat(c[0].toFixed(3)),j=parseFloat(c[1].toFixed(3)),f=parseFloat(c[2].toFixed(3)),a=parseFloat(c[3].toFixed(3)),n=parseFloat(c[4].toFixed(3)),v=parseFloat(c[5].toFixed(3));if(k){k=parseFloat(c[6].toFixed(3));var r=parseFloat(c[7].toFixed(3)),c=parseFloat(c[8].toFixed(3));return[b,a,k,j,n,r,f,v,c]}return[b,a,j,n,f,v]},clone:function(){var k=this.elements[0],c=this.elements[1],b=this.elements[2],j=this.elements[3],f=this.elements[4],a=this.elements[5];
g=this.elements[6];h=this.elements[7];i=this.elements[8];return new Two.Matrix(k,c,b,j,f,a,g,h,i)}})})();(function(){function q(c){var b={},j=c.id,f=c.translation,a=c.rotation,n=c.scale,v=c.stroke,r=c.linewidth,e=c.fill,p=c.opacity,q=c.visible,x=c.cap,s=c.join,y=c.miter,t=c.curved,w=c.closed,d=c.vertices;j&&(b.id=k.Identifier+j);f&&(_.isNumber(n)&&_.isNumber(a))&&(b.transform="matrix("+c._matrix.toString()+")");v&&(b.stroke=v);e&&(b.fill=e);p&&(b["stroke-opacity"]=b["fill-opacity"]=p);b.visibility=q?"visible":"hidden";x&&(b["stroke-linecap"]=x);s&&(b["stroke-linejoin"]=s);y&&(b["stroke-miterlimit"]=
y);r&&(b["stroke-width"]=r);d&&(b.d=l.toString(d,w,t));return b}var f=Two.Utils.getCurveFromPoints,p=Two.Utils.mod,l={version:1.1,ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(c,b){var j=c.toLowerCase(),k=document.createElementNS(this.ns,j);"svg"===j&&(b=_.defaults(b||{},{version:this.version}));_.isObject(b)&&this.setAttributes(k,b);return k},setAttributes:function(c,b){_.each(b,function(b,c){this.setAttribute(c,b)},c);return this},removeAttributes:function(c,
b){_.each(b,function(b){this.removeAttribute(b)},c);return this},toString:function(c,b,j){var k=c.length,a=k-1;if(!j)return _.map(c,function(c,j){var e;e=(0>=j?"M":"L")+(" "+c.x.toFixed(3)+" "+c.y.toFixed(3));j>=a&&b&&(e+=" Z");return e}).join(" ");var n=f(c,b);return _.map(n,function(c,j){var e,f=b?p(j-1,k):Math.max(j-1,0),l=b?p(j+1,k):Math.min(j+1,a);e=n[f];var l=n[l],f=e.v.x.toFixed(3),q=e.v.y.toFixed(3),s=c.u.x.toFixed(3),y=c.u.y.toFixed(3),t=c.x.toFixed(3),w=c.y.toFixed(3);e=0>=j?"M "+t+" "+
w:"C "+f+" "+q+" "+s+" "+y+" "+t+" "+w;j>=a&&b&&(f=c.v.x.toFixed(3),q=c.v.y.toFixed(3),s=l.u.x.toFixed(3),y=l.u.y.toFixed(3),t=l.x.toFixed(3),w=l.y.toFixed(3),e=e+(" C "+f+" "+q+" "+s+" "+y+" "+t+" "+w)+" Z");return e}).join(" ")}},k=Two[Two.Types.svg]=function(){this.count=0;this.domElement=l.createElement("svg");this.elements=[];this.domElement.style.visibility="hidden";this.unveil=_.once(_.bind(function(){this.domElement.style.visibility="visible"},this))};_.extend(k,{Identifier:"two-"});_.extend(k.prototype,
Backbone.Events,{setSize:function(c,b){this.width=c;this.height=b;l.setAttributes(this.domElement,{width:c,height:b});return this},add:function(c){var b=c,j=this.elements,k=this.domElement;_.isArray(c)||(b=_.map(arguments,function(a){return a}));_.each(b,function(a){var b;b=a instanceof Two.Group;if(_.isUndefined(a.id)){var c=this.count;this.count++;a.id=c}b?(b="g",_.isUndefined(a.parent)&&(a.parent=this,a.unbind(Two.Events.change).bind(Two.Events.change,_.bind(this.update,this))),a=q(a),delete a.stroke,
delete a.fill,delete a["fill-opacity"],delete a["stroke-opacity"],delete a["stroke-linecap"],delete a["stroke-linejoin"],delete a["stroke-miterlimit"],delete a["stroke-width"]):(b="path",a=q(a));a=l.createElement(b,a);k.appendChild(a);j.push(a)},this);return this},update:function(c,b,j,k,a){var n=this.elements,f=n[c];switch(b){case Two.Properties.hierarchy:_.each(j,function(a){f.appendChild(n[a])});break;case Two.Properties.demotion:_.each(j,function(a){f.removeChild(n[a])});break;default:a:{c=b;
switch(c){case "matrix":c="transform";j="matrix("+j.toString()+")";break;case "visible":c="visibility";j=j?"visible":"hidden";break;case "cap":c="stroke-linecap";break;case "join":c="stroke-linejoin";break;case "miter":c="stroke-miterlimit";break;case "linewidth":c="stroke-width";break;case "vertices":c="d";j=l.toString(j,k,a);break;case "opacity":l.setAttributes(f,{"stroke-opacity":j,"fill-opacity":j});break a}f.setAttribute(c,j)}}return this},render:function(){this.unveil();return this}})})();(function(){var q=Two.Utils.getCurveFromPoints,f=Two.Utils.mod,p=function(b){_.each(b,function(b,c){this[c]=b},this);this.children={}};_.extend(p.prototype,{appendChild:function(b){var c=b.parent,k=b.id;_.isUndefined(c)||delete c.children[k];this.children[k]=b;b.parent=this;return this},removeChild:function(b){delete this.children[b.id];return this},render:function(b){var c=this.matrix;b.save();b.transform(c[0],c[1],c[2],c[3],c[4],c[5]);_.each(this.children,function(c){c.render(b)});b.restore();return this}});
var l=function(b){_.each(b,function(b,c){this[c]=b},this)};_.extend(l.prototype,{render:function(b){var c=this.matrix,k=this.stroke,a=this.linewidth,n=this.fill,l=this.opacity,r=this.cap,e=this.join,p=this.miter,q=this.curved,x=this.closed,s=this.commands,y=s.length,t=y-1;if(!this.visible)return this;b.save();c&&b.transform(c[0],c[1],c[2],c[3],c[4],c[5]);n&&(b.fillStyle=n);k&&(b.strokeStyle=k);a&&(b.lineWidth=a);p&&(b.miterLimit=p);e&&(b.lineJoin=e);r&&(b.lineCap=r);_.isNumber(l)&&(b.globalAlpha=
l);b.beginPath();_.each(s,function(a,d){var e=a.x.toFixed(3),c=a.y.toFixed(3);if(q){var j=x?f(d-1,y):Math.max(d-1,0),k=x?f(d+1,y):Math.min(d+1,t),n=s[j],k=s[k],j=n.v.x.toFixed(3),n=n.v.y.toFixed(3),r=a.u.x.toFixed(3),l=a.u.y.toFixed(3);0>=d?b.moveTo(e,c):(b.bezierCurveTo(j,n,r,l,e,c),d>=t&&x&&(j=a.v.x.toFixed(3),n=a.v.y.toFixed(3),r=k.u.x.toFixed(3),l=k.u.y.toFixed(3),e=k.x.toFixed(3),c=k.y.toFixed(3),b.bezierCurveTo(j,n,r,l,e,c)))}else 0>=d?b.moveTo(e,c):b.lineTo(e,c)});x&&!q&&b.closePath();b.fill();
b.stroke();b.restore()}});var k={toArray:function(b,c,k){return!c?_.map(b,function(a){return{x:a.x,y:a.y}}):q(b,k)}},c=Two[Two.Types.canvas]=function(){this.count=0;this.domElement=document.createElement("canvas");this.ctx=this.domElement.getContext("2d");this.elements=[];this.stage=null};_.extend(c,{});_.extend(c,{Group:p,Element:l,getStyles:function(b){var c={},f=b.id,a=b._matrix,n=b.stroke,l=b.linewidth,r=b.fill,e=b.opacity,p=b.visible,q=b.cap,x=b.join,s=b.miter,y=b.curved,t=b.closed;b=b.vertices;
f&&(c.id=f);_.isObject(a)&&(c.matrix=a.toArray());n&&(c.stroke=n);r&&(c.fill=r);_.isNumber(e)&&(c.opacity=e);q&&(c.cap=q);x&&(c.join=x);s&&(c.miter=s);l&&(c.linewidth=l);b&&(c.commands=k.toArray(b,y,t));c.visible=!!p;c.curved=!!y;c.closed=!!t;return c},setStyles:function(b,c,f,a,n){switch(c){case "matrix":c="matrix";f=f.toArray();break;case "vertices":c="commands",b.curved=n,b.closed=a,f=k.toArray(f,b.curved,b.closed)}b[c]=f},Utils:k});_.extend(c.prototype,Backbone.Events,{setSize:function(b,c){this.width=
this.domElement.width=b;this.height=this.domElement.height=c;_.extend(this.domElement.style,{width:this.width+"px",height:this.height+"px"});return this},add:function(b){constructor=Object.getPrototypeOf(this).constructor;var c=b,k=this.elements,a=constructor.Group,n=constructor.Element,f=constructor.getStyles;_.isArray(b)||(c=_.map(arguments,function(a){return a}));_.each(c,function(b){var c;c=b instanceof Two.Group;var j=_.isNull(this.stage);if(_.isUndefined(b.id)){var l=this.count;this.count++;
b.id=l}c?(c=f.call(this,b),delete c.stroke,delete c.fill,delete c.opacity,delete c.cap,delete c.join,delete c.miter,delete c.linewidth,c=new a(c),j&&(this.stage=c,this.stage.object=b,b.parent=this,b.unbind(Two.Events.change).bind(Two.Events.change,_.bind(this.update,this)))):c=new n(f.call(this,b));k.push(c);j||this.stage.appendChild(c)},this);return this},update:function(b,c,k,a,f,l){var r=Object.getPrototypeOf(this).constructor,e=this.elements,p=e[b];switch(c){case Two.Properties.hierarchy:_.each(k,
function(a){p.appendChild(e[a])});break;case Two.Properties.demotion:_.each(k,function(a){p.removeChild(e[a]);this.elements[a]=null},this);break;default:r.setStyles.call(this,p,c,k,a,f,l)}return this},render:function(){if(_.isNull(this.stage))return this;this.ctx.clearRect(0,0,this.width,this.height);this.stage.render(this.ctx);return this}})})();(function(){function q(a,b){var c=Math.min(a.top,b.top),j=Math.min(a.left,b.left),e=Math.max(a.right,b.right),k=Math.max(a.bottom,b.bottom);return{top:c,left:j,right:e,bottom:k,width:e-j,height:k-c,centroid:{x:-j,y:-c}}}var f=Two[Two.Types.canvas],p=Two.Matrix.Multiply,l=Two[Two.Types.canvas].Utils.toArray,k=Two.Utils.mod,c=function(a){f.Group.call(this,a)};_.extend(c.prototype,f.Group.prototype,{appendChild:function(){f.Group.prototype.appendChild.apply(this,arguments);this.updateMatrix();return this},
updateTexture:function(a){_.each(this.children,function(b){b.updateTexture(a)});return this},updateMatrix:function(a){var b=a&&a._matrix||this.parent&&this.parent._matrix;a=a&&a._scale||this.parent&&this.parent._scale;if(!b)return this;this._matrix=p(this.matrix,b);this._scale=this.scale*a;_.each(this.children,function(a){a.updateMatrix(this)},this);return this},render:function(a,b){_.each(this.children,function(c){c.render(a,b)})}});var b=function(a){f.Element.call(this,a)};_.extend(b.prototype,
f.Element.prototype,{updateMatrix:function(a){var b=a&&a._matrix||this.parent&&this.parent._matrix;a=a&&a._scale||this.parent&&this.parent._scale;if(!b)return this;this._matrix=p(this.matrix,b);this._scale=this.scale*a;return this},updateTexture:function(a){j.updateTexture(a,this);return this},render:function(a,b){if(!this.visible||!this.opacity||!this.buffer)return this;a.bindBuffer(a.ARRAY_BUFFER,this.textureCoordsBuffer);a.vertexAttribPointer(b.textureCoords,2,a.FLOAT,!1,0,0);a.bindTexture(a.TEXTURE_2D,
this.texture);a.uniformMatrix3fv(b.matrix,!1,this._matrix);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);a.vertexAttribPointer(b.position,2,a.FLOAT,!1,0,0);a.drawArrays(a.TRIANGLES,0,6);return this}});var j={canvas:document.createElement("canvas"),uv:new Two.Array([0,0,1,0,0,1,0,1,1,0,1,1]),getBoundingClientRect:function(a,b,c){var j=Infinity,e=-Infinity,k=Infinity,f=-Infinity;_.each(a,function(a){var b=a.x,n=a.y,l;k=Math.min(n,k);j=Math.min(b,j);e=Math.max(b,e);f=Math.max(n,f);c&&(b=a.u.x,n=a.u.y,l=a.v.x,
a=a.v.y,k=Math.min(n,a,k),j=Math.min(b,l,j),e=Math.max(b,l,e),f=Math.max(n,a,f))});_.isNumber(b)&&(k-=b,j-=b,e+=b,f+=b);return{top:k,left:j,right:e,bottom:f,width:e-j,height:f-k,centroid:{x:-j,y:-k}}},getTriangles:function(a){var b=a.top,c=a.left,j=a.right;a=a.bottom;return new Two.Array([c,b,j,b,c,a,c,a,j,b,j,a])},updateCanvas:function(a){var b=a.commands,c=this.canvas,j=this.ctx,e=a._scale,f=a.stroke,l=a.linewidth*e,p=a.fill,q=a.opacity,u=a.cap,t=a.join,w=a.miter,d=a.curved,z=a.closed,B=b.length,
M=B-1;c.width=Math.max(Math.ceil(a.rect.width*e),1);c.height=Math.max(Math.ceil(a.rect.height*e),1);a=a.rect.centroid;var H=a.x*e,D=a.y*e;j.clearRect(0,0,c.width,c.height);p&&(j.fillStyle=p);f&&(j.strokeStyle=f);l&&(j.lineWidth=l);w&&(j.miterLimit=w);t&&(j.lineJoin=t);u&&(j.lineCap=u);_.isNumber(q)&&(j.globalAlpha=q);j.beginPath();_.each(b,function(a,c){var f=(a.x*e+H).toFixed(3),l=(a.y*e+D).toFixed(3);if(d){var p=z?k(c-1,B):Math.max(c-1,0),q=z?k(c+1,B):Math.min(c+1,M),v=b[p],q=b[q],p=(v.v.x*e+H).toFixed(3),
v=(v.v.y*e+D).toFixed(3),m=(a.u.x*e+H).toFixed(3),u=(a.u.y*e+D).toFixed(3);0>=c?j.moveTo(f,l):(j.bezierCurveTo(p,v,m,u,f,l),c>=M&&z&&(p=(a.v.x*e+H).toFixed(3),v=(a.v.y*e+D).toFixed(3),m=(q.u.x*e+H).toFixed(3),u=(q.u.y*e+D).toFixed(3),f=(q.x*e+H).toFixed(3),l=(q.y*e+D).toFixed(3),j.bezierCurveTo(p,v,m,u,f,l)))}else 0>=c?j.moveTo(f,l):j.lineTo(f,l)});z&&!d&&j.closePath();j.fill();j.stroke()},updateTexture:function(a,b){this.updateCanvas(b);b.texture&&a.deleteTexture(b.texture);a.bindBuffer(a.ARRAY_BUFFER,
b.textureCoordsBuffer);b.texture=a.createTexture();a.bindTexture(a.TEXTURE_2D,b.texture);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);0>=this.canvas.width||0>=this.canvas.height||a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.canvas)},updateBuffer:function(a,b,c){_.isObject(b.buffer)&&a.deleteBuffer(b.buffer);b.buffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,
b.buffer);a.enableVertexAttribArray(c.position);a.bufferData(a.ARRAY_BUFFER,b.triangles,a.STATIC_DRAW);_.isObject(b.textureCoordsBuffer)&&a.deleteBuffer(b.textureCoordsBuffer);b.textureCoordsBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b.textureCoordsBuffer);a.enableVertexAttribArray(c.textureCoords);a.bufferData(a.ARRAY_BUFFER,this.uv,a.STATIC_DRAW)},program:{create:function(a,b){var c=a.createProgram();_.each(b,function(b){a.attachShader(c,b)});a.linkProgram(c);if(!a.getProgramParameter(c,
a.LINK_STATUS))throw error=a.getProgramInfoLog(c),a.deleteProgram(c),new Two.Utils.Error("unable to link program: "+error);return c}},shaders:{create:function(a,b,c){c=a.createShader(a[c]);a.shaderSource(c,b);a.compileShader(c);if(!a.getShaderParameter(c,a.COMPILE_STATUS))throw b=a.getShaderInfoLog(c),a.deleteShader(c),new Two.Utils.Error("unable to compile shader "+c+": "+b);return c},types:{vertex:"VERTEX_SHADER",fragment:"FRAGMENT_SHADER"},vertex:"attribute vec2 a_position;\nattribute vec2 a_textureCoords;\n\nuniform mat3 u_matrix;\nuniform vec2 u_resolution;\n\nvarying vec2 v_textureCoords;\n\nvoid main() {\n   vec2 projected = (u_matrix * vec3(a_position, 1)).xy;\n   vec2 normal = projected / u_resolution;\n   vec2 clipspace = (normal * 2.0) - 1.0;\n\n   gl_Position = vec4(clipspace * vec2(1.0, -1.0), 0.0, 1.0);\n   v_textureCoords = a_textureCoords;\n}",
fragment:"precision mediump float;\n\nuniform sampler2D u_image;\nvarying vec2 v_textureCoords;\n\nvoid main() {\n  gl_FragColor = texture2D(u_image, v_textureCoords);\n}"}};j.ctx=j.canvas.getContext("2d");var u=Two[Two.Types.webgl]=function(a){this.count=0;this.domElement=document.createElement("canvas");this.elements=[];this.stage=null;a=_.defaults(a||{},{antialias:!1,alpha:!0,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!1});a=this.ctx=this.domElement.getContext("webgl",a)||this.domElement.getContext("experimental-webgl",
a);if(!this.ctx)throw new Two.Utils.Error("unable to create a webgl context. Try using another renderer.");var b=j.shaders.create(a,j.shaders.vertex,j.shaders.types.vertex),c=j.shaders.create(a,j.shaders.fragment,j.shaders.types.fragment);this.program=j.program.create(a,[b,c]);a.useProgram(this.program);this.program.position=a.getAttribLocation(this.program,"a_position");this.program.matrix=a.getUniformLocation(this.program,"u_matrix");this.program.textureCoords=a.getAttribLocation(this.program,"a_textureCoords");
a.disable(a.DEPTH_TEST);a.enable(a.BLEND);a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD);a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)};_.extend(u,{Group:c,Element:b,getStyles:function(a){var c={},k=a.id,f=a._matrix,e=a.stroke,p=a.linewidth,q=a.fill,u=a.opacity,s=a.visible,y=a.cap,t=a.join,w=a.miter,d=a.curved,z=a.closed,B=a.vertices;k&&(c.id=k);_.isObject(f)&&(c.matrix=c._matrix=f.toArray(!0),c.scale=c._scale=1);e&&(c.stroke=e);q&&(c.fill=q);_.isNumber(u)&&(c.opacity=
u);y&&(c.cap=y);t&&(c.join=t);w&&(c.miter=w);p&&(c.linewidth=p);B&&(c.vertices=l(B,d,z),c.commands=c.vertices,c.rect=j.getBoundingClientRect(c.commands,c.linewidth,c.curved),c.triangles=j.getTriangles(c.rect));c.visible=!!s;c.curved=!!d;c.closed=!!z;a instanceof Two.Polygon&&(j.updateBuffer(this.ctx,c,this.program),b.prototype.updateTexture.call(c,this.ctx));return c},setStyles:function(a,b,c,k,e,f){var p=!1;/matrix/.test(b)?(a[b]=c.toArray(!0),_.isNumber(k)&&(p=a.scale!==k,a.scale=k),a.updateMatrix()):
/(stroke|fill|opacity|cap|join|miter|linewidth)/.test(b)?(a[b]=c,a.rect=q(j.getBoundingClientRect(a.commands,a.linewidth,a.curved),a.rect),a.triangles=j.getTriangles(a.rect),j.updateBuffer(this.ctx,a,this.program),p=!0):"vertices"===b?(_.isUndefined(k)||(a.closed=k),_.isUndefined(e)||(a.curved=e),f?a.commands=l(c,a.curved,a.closed):(a.vertices=l(c,a.curved,a.closed),a.commands=a.vertices),a.rect=q(j.getBoundingClientRect(a.vertices,a.linewidth,a.curved),a.rect),a.triangles=j.getTriangles(a.rect),
j.updateBuffer(this.ctx,a,this.program),p=!0):a[b]=c;p&&a.updateTexture(this.ctx)}});_.extend(u.prototype,Backbone.Events,f.prototype,{setSize:function(a,b){f.prototype.setSize.apply(this,arguments);this.ctx.viewport(0,0,a,b);var c=this.ctx.getUniformLocation(this.program,"u_resolution");this.ctx.uniform2f(c,a,b);return this},render:function(){if(_.isNull(this.stage))return this;this.stage.render(this.ctx,this.program);return this}})})();(function(){var q=Two.Shape=function(f){this._matrix=new Two.Matrix;var p=_.debounce(_.bind(function(){var f=this._matrix.identity().translate(this.translation.x,this.translation.y).scale(this.scale).rotate(this.rotation);this.trigger(Two.Events.change,this.id,"matrix",f,this.scale)},this),0);this._rotation=0;Object.defineProperty(this,"rotation",{get:function(){return this._rotation},set:function(f){this._rotation=f;p()}});this._scale="scale";Object.defineProperty(this,"scale",{get:function(){return this._scale},
set:function(f){this._scale=f;p()}});this.translation=new Two.Vector;this.rotation=0;this.scale=1;this.translation.bind(Two.Events.change,p);if(f)return this;q.MakeGetterSetter(this,q.Properties);this.fill="#fff";this.stroke="#000";this.opacity=this.linewidth=1;this.visible=!0;this.join=this.cap="round";this.miter=1};_.extend(q,{Properties:"fill stroke linewidth opacity visible cap join miter".split(" "),MakeGetterSetter:function(f,p){_.isArray(p)||(p=[p]);_.each(p,function(l){var k="_"+l;Object.defineProperty(f,
l,{get:function(){return this[k]},set:function(c){this[k]=c;this.trigger(Two.Events.change,this.id,l,c,this)}})})}});_.extend(q.prototype,Backbone.Events,{addTo:function(f){f.add(this);return this},noFill:function(){this.fill="transparent";return this},noStroke:function(){this.stroke="transparent";return this},clone:function(){var f=new q;f.translation.copy(this.translation);_.each(q.Properties,function(p){f[p]=this[p]},this);return this}})})();(function(){var q=Two.Group=function(){Two.Shape.call(this,!0);delete this.stroke;delete this.fill;delete this.linewidth;delete this.opacity;delete this.cap;delete this.join;delete this.miter;q.MakeGetterSetter(this,Two.Shape.Properties);this.children={}};_.extend(q,{MakeGetterSetter:function(f,p){_.isArray(p)||(p=[p]);_.each(p,function(l){var k="_"+l;Object.defineProperty(f,l,{get:function(){return this[k]},set:function(c){this[k]=c;_.each(this.children,function(b){b[l]=c})}})})}});_.extend(q.prototype,
Two.Shape.prototype,{clone:function(f){f=f||this.parent;var p=_.map(this.children,function(k){return k.clone(f)}),l=new q;f.add(l);l.add(p);l.translation.copy(this.translation);l.rotation=this.rotation;l.scale=this.scale;return l},center:function(){var f=this.getBoundingClientRect();f.centroid={x:f.left+f.width/2,y:f.top+f.height/2};_.each(this.children,function(p){p.translation.subSelf(f.centroid)});this.translation.copy(f.centroid);return this},add:function(f){var p=f,l=this.children,k=this.parent,
c=[];_.isArray(f)||(p=_.toArray(arguments));var b=_.bind(function(b,c,a,k,f,l){this.trigger(Two.Events.change,b,c,a,k,f,l)},this);_.each(p,function(j){var f=j.id,a=j.parent;_.isUndefined(f)&&(k.add(j),f=j.id);_.isUndefined(l[f])&&(a&&delete a.children[f],l[f]=j,j.parent=this,j.unbind(Two.Events.change).bind(Two.Events.change,b),c.push(f))},this);0<c.length&&this.trigger(Two.Events.change,this.id,Two.Properties.hierarchy,c);return this},remove:function(f){var p=f,l=this.children,k=this.parent,c=[];
if(0>=arguments.length&&k)return k.remove(this),this;_.isArray(f)||(p=_.toArray(arguments));_.each(p,function(b){var j=b.id;j in l&&(delete l[j],b.unbind(Two.Events.change),c.push(j))});0<c.length&&this.trigger(Two.Events.change,this.id,Two.Properties.demotion,c);return this},getBoundingClientRect:function(){var f=Infinity,p=-Infinity,l=Infinity,k=-Infinity;_.each(this.children,function(b){b=b.getBoundingClientRect();l&&(f&&p&&k)&&(l=Math.min(b.top,l),f=Math.min(b.left,f),p=Math.max(b.right,p),k=
Math.max(b.bottom,k))},this);var c=this._matrix.multiply(f,l,1),b=this._matrix.multiply(p,k,1);return{top:c.y,left:c.x,right:b.x,bottom:b.y,width:b.x-c.x,height:b.y-c.y}},noFill:function(){_.each(this.children,function(f){f.noFill()});return this},noStroke:function(){_.each(this.children,function(f){f.noStroke()});return this}})})();(function(){var q=Math.min,f=Math.max,p=Math.round,l=Two.Polygon=function(k,c,b){Two.Shape.call(this);c=!!c;b=!!b;var j=0,l=1,a=!1,n=k.slice(0),v=_.debounce(_.bind(function(){var f,e;if(a){f=this.vertices.length;f-=1;e=p(j*f);f=p(l*f);for(n.length=0;e<f+1;e++){var k=this.vertices[e];n.push(new Two.Vector(k.x,k.y))}}this.trigger(Two.Events.change,this.id,"vertices",n,c,b,a);a=!1},this),0);Object.defineProperty(this,"closed",{get:function(){return c},set:function(a){c=!!a;v()}});Object.defineProperty(this,
"curved",{get:function(){return b},set:function(a){b=!!a;v()}});Object.defineProperty(this,"beginning",{get:function(){return j},set:function(b){j=q(f(b,0),1);a=!0;v()}});Object.defineProperty(this,"ending",{get:function(){return l},set:function(b){l=q(f(b,0),1);a=!0;v()}});this.vertices=k.slice(0);_.each(this.vertices,function(a){a.bind(Two.Events.change,v)},this);v()};_.extend(l.prototype,Two.Shape.prototype,{clone:function(){var f=_.map(this.vertices,function(b){return new Two.Vector(b.x,b.y)}),
c=new l(f,this.closed,this.curved);_.each(Two.Shape.Properties,function(b){c[b]=this[b]},this);c.translation.copy(this.translation);c.rotation=this.rotation;c.scale=this.scale;return c},center:function(){var f=this.getBoundingClientRect();f.centroid={x:f.left+f.width/2,y:f.top+f.height/2};_.each(this.vertices,function(c){c.subSelf(f.centroid)});this.translation.addSelf(f.centroid);return this},remove:function(){if(!this.parent)return this;this.parent.remove(this);return this},getBoundingClientRect:function(){var f=
this.linewidth,c=Infinity,b=-Infinity,j=Infinity,l=-Infinity;_.each(this.vertices,function(a){var f=a.x;a=a.y;j=Math.min(a,j);c=Math.min(f,c);b=Math.max(f,b);l=Math.max(a,l)});var j=j-f,c=c-f,b=b+f,l=l+f,f=this._matrix.multiply(c,j,1),a=this._matrix.multiply(b,l,1);return{top:f.y,left:f.x,right:a.x,bottom:a.y,width:a.x-f.x,height:a.y-f.y}}})})();
